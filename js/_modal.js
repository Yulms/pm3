"use strict";import{isEscapePressEvent,scrollLock,executeAfterAnimationEnd}from"./util.js";const ModalPosition={CENTER:"center",LEFT:"left"},ModalPositionClasses={[ModalPosition.CENTER]:"modal--center",[ModalPosition.LEFT]:"modal--left"},ModalSize={SMALL:"small",BIG:"big"},ModalSizeClasses={[ModalSize.SMALL]:"modal--small",[ModalSize.BIG]:"modal--big"};class Modal{constructor(e){const t={triggerDataAttributeName:"data-modal",closeModalClass:"modal__content--closed",modalTemplateSelector:"#modal",modalBodySelector:".modal",modalTypeDataAttribute:"modalPosition",defaultPosition:ModalPosition.CENTER,modalSizeDataAttribute:"modalSize",overlaySelector:"overlay",modalOverlaySelector:"modal__overlay",closeButtonSelector:".modal__close-button",focusElements:['input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden]):not(.button--modal-close)","iframe",'[tabindex]:not([tabindex^="-"])'],animationOnCloseClass:"modal--animation-on-close",animationOnCloseName:"hideModal"};Object.assign(this,t,e),this._modals=[],this._documentKeydownHandlerWasAdded=!1,this.handleEvent=e=>{switch(e.type){case"keydown":isEscapePressEvent(e,this._closeAfterAnnimationEnd.bind(this))}},document.addEventListener("click",e=>{let t=e.target.closest("["+this.triggerDataAttributeName+"]");t&&(e.preventDefault(),this._open(t))})}_open(e){this._modals.push({});let t=this._modals[this._getLastModalIndex()];t._triggerElement=e,t._modalElement=(()=>document.querySelector(this.modalTemplateSelector).content.querySelector(this.modalBodySelector).cloneNode(!0))(),(t=>{let o=(()=>e.dataset[this.modalTypeDataAttribute]||this.defaultPosition)();t._modalElement.classList.add(ModalPositionClasses[o])})(t),(t=>{let o=e.dataset[this.modalSizeDataAttribute];o&&t._modalElement.classList.add(ModalSizeClasses[o])})(t);let o=e.getAttribute(this.triggerDataAttributeName);t._modalContentElement=document.querySelector(o),(e=>{e._modalContentElementHomelandPosition={parentElement:e._modalContentElement.parentElement,nextElement:e._modalContentElement.nextElementSibling}})(t),(e=>{e._modalContentElement.getAttribute("aria-hidden")&&(e._modalContentElement.setAttribute("aria-hidden",!1),e._ariaAttrWasRemoved=!0)})(t),t._modalElement.children[0].prepend(t._modalContentElement),(e=>{e._overlayElement=document.createElement("div"),e._overlayElement.classList.add(this.overlaySelector),e._overlayElement.classList.add(this.modalOverlaySelector),e._modalElement.append(e._overlayElement)})(t),document.body.append(t._modalElement),(e=>{e._modalContentElement.classList.contains(this.closeModalClass)?(e._modalContentElement.classList.remove(this.closeModalClass),e._closedClassWasRemoved=!0):e._modalContentElement.style.display="block"})(t),(e=>{e._modalElement.querySelector(this.closeButtonSelector).addEventListener("click",this._closeAfterAnnimationEnd.bind(this)),e._overlayElement.addEventListener("click",this._closeAfterAnnimationEnd.bind(this)),this._documentKeydownHandlerWasAdded||(document.addEventListener("keydown",this),this._documentKeydownHandlerWasAdded=!0)})(t),1===this._modals.length&&scrollLock({lock:!0}),this._focus(t,{shouldBeInside:!0})}_closeAfterAnnimationEnd(){let e=this._modals[this._getLastModalIndex()];executeAfterAnimationEnd({element:e._modalElement,animationClass:this.animationOnCloseClass,animationName:this.animationOnCloseName,callback:this._close.bind(this)})}_close(){let e=this._modals[this._getLastModalIndex()];e._modalContentElement.style.display="",e._closedClassWasRemoved&&e._modalContentElement.classList.add(this.closeModalClass),e._ariaAttrWasRemoved&&e._modalContentElement.setAttribute("aria-hidden",!0);let{parentElement:t,nextElement:o}=e._modalContentElementHomelandPosition;t.insertBefore(e._modalContentElement,o),e._modalElement.remove(),(()=>{1===this._modals.length&&(document.removeEventListener("keydown",this),this._documentKeydownHandlerWasAdded=!1)})(),this._modals.pop(),0===this._modals.length&&scrollLock({lock:!1}),this._focus(e,{shouldBeInside:!1})}_getLastModalIndex(){return this._modals.length-1}_focus(e,{shouldBeInside:t}){const o=e._modalElement.querySelectorAll(this.focusElements);t?o.length&&o[0].focus():e._triggerElement.focus()}}function initModal(){return new Modal}export default initModal;